<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compra</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">    
    <style>
        .product-card img {
            width: 100%;
            height: auto;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 5px 10px 10px 0px rgba(0,0,0,0.17);
        }
    </style>
</head>
<!-- <h1>Bienvenido Carrito de Compra</h1> -->

<body>
    <button class="btn btn-success" onclick="carrito.mostrarCarrito()">Ver Carrito</button>

    <main class="container my-4">
        <h1 class="text-center mb-4">Catálogo de Zapatillas</h1>
        <div class="row" id="product-list"></div>
        <div class="text-center my-4">
        </div>
    </main>


    <!-- Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="productModalLabel">Detalles del Producto</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <img id="modal-img" src="" class="img-fluid mb-3" alt="Producto">
            <h5 id="modal-name"></h5>
            <p id="modal-price"></p>
            <label for="size">Seleccione talla:</label>
            <select id="size" class="form-select mb-3">
               
            </select>
            <label for="cantidad">Cantidad:</label>
            <input type="number" id="cantidad" class="form-control" value="1" min="1">
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button type="button" id="add-to-cart" class="btn btn-primary">Añadir al carrito</button>
            </div>
        </div>
        </div>
    </div>

    <!-- Modal para el pago -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">Seleccione el método de pago</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="payment-method">Elija un método de pago:</label>
                    <select id="payment-method" class="form-select mb-3">
                        <option value="debito">Tarjeta de Débito</option>
                        <option value="credito">Tarjeta de Crédito</option>
                    </select>
                    <button class="btn btn-primary" onclick="procesarPago()">Procesar Pago</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de éxito -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="successModalLabel">Compra Exitosa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Su compra ha sido realizada con éxito. ¡Gracias por su compra!</p>
                </div>
            </div>
        </div>
    </div>
  
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- <script src="assets/js/models.js"></script> -->
    <script>
        // Clase Producto con ID
        class Producto {
        constructor(id, nombre, precio, genero, imagen) {
            this.id = id;
            this.nombre = nombre;
            this.genero = genero;
            this.precio = precio;
            this.imagen = imagen;
        }
        }

        // Clase Carrito
        class Carrito {
        constructor() {
            this.items = []; // Lista de productos en el carrito
        }

        // Método para agregar productos al carrito
        agregarProducto(producto, talla, cantidad) {
            // Verificar si ya existe el mismo producto con la misma talla
            const itemExistente = this.items.find(
            (item) => item.producto.id === producto.id && item.talla === talla
            );

            if (itemExistente) {
            // Si ya existe, actualizar la cantidad
            itemExistente.cantidad += cantidad;
            } else {
            // Si no existe, agregar un nuevo item
            this.items.push({ producto, talla, cantidad });
            }
        }

        // Método para calcular el total del carrito
        calcularTotal() {
            return this.items.reduce((total, item) => {
            return total + item.producto.precio * item.cantidad;
            }, 0);
        }

        // Método para mostrar los detalles del carrito, incluyendo el precio y el total
            mostrarCarrito() {
            if (this.items.length === 0) {
                alert("El carrito está vacío.");
                } else {
                let detallesCarrito = "Productos en el carrito:\n";
                this.items.forEach((item) => {
                    let subtotal = item.producto.precio * item.cantidad;
                    detallesCarrito += `${item.producto.nombre} - Talla: ${item.talla}, Cantidad: ${item.cantidad}, Subtotal: $${subtotal}\n`;
                });

                let totalCarrito = this.calcularTotal(); // Calcular el total
                detallesCarrito += `\nTotal a pagar: $${totalCarrito}`;

                detallesCarrito += `\n\n¿Deseas ir a pagar?`;

                if (confirm(detallesCarrito)) {
                    // Si el usuario acepta, abrir el modal de pago
                    var myModal = new bootstrap.Modal(document.getElementById('paymentModal'));
                    myModal.show();
                }
                }
          }

          vaciarCarrito() {
            this.items = [];
          }
        }

    // Crear productos
    const listadoProductos = [
    new Producto(1, "Jordan Retro 4 Red Thunder", 1200, "Hombre"),
    new Producto(2, "Nike Air Force 1 Off-White", 1500, "Unisex"),
    new Producto(3, "Bape Superstar", 1800, "Mujer"),
    new Producto(4, "Vans Old Skool", 800, "Unisex"),
    new Producto(5, "Air Jordan 1 High", 1300, "Hombre"),
    new Producto(6, "Adidas Yeezy Boost 350 V2", 2000, "Hombre"),
    new Producto(7, "Reebok Classic Leather", 700, "Mujer"),
    new Producto(8, "DC Shoes Lynx", 900, "Hombre"),
    new Producto(9, "Nike SB Dunk Low Pro ISO", 1100, "Unisex"),
    new Producto(10, "Adidas Yung-1", 1600, "Hombre"),
    new Producto(11, "Bape x Adidas Ultraboost", 1900, "Mujer"),
    new Producto(12, "Vans Sk8-Hi", 1100, "Unisex"),
    new Producto(13, "ASICS Gel-Cumulus 23", 1400, "Hombre"),
    new Producto(14, "Adidas Yeezy 750 Boost", 2200, "Hombre"),
    new Producto(15, "Saucony Grid 9000", 1200, "Unisex"),
    new Producto(16, "Reebok Club C", 1000, "Mujer"),
    new Producto(17, "Skechers Relaxed Fit: Ultra", 1500, "Unisex"),
    new Producto(18, "Air Jordan 4 Black Cat", 1800, "Hombre"),
    new Producto(19, "Bape Superstar Rocket Raccoon", 1900, "Unisex"),
    new Producto(20, "Adidas Ultraboost 20", 2100, "Unisex"),
    ];

function mostrarProductos() {
  const productList = document.getElementById("product-list");

  listadoProductos.forEach((producto) => {
    const productHTML = `
            <div class="col-md-3">
                <div class="card product-card">
                    <img src="https://via.placeholder.com/150x150" class="card-img-top" alt="${producto.nombre}">
                    <div class="card-body">
                        <h6 class="card-title">${producto.nombre}</h5>
                        <p class="card-text text-muted">Zapatillas para: ${producto.genero}</p>
                        <p class="card-text">Precio: $${producto.precio}</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productModal" onclick="mostrarDetalles(${producto.id})">Ver detalles</button>
                    </div>
                </div>
            </div>
        `;
    productList.innerHTML += productHTML;
  });
}

document.addEventListener("DOMContentLoaded", function () {
  mostrarProductos();
});

function generarTallas(genero) {
  let tallas = [];

  if (genero === "Hombre") {
    for (let i = 38; i <= 45; i++) {
      tallas.push(i);
    }
  } else if (genero === "Mujer") {
    for (let i = 35; i <= 41; i++) {
      tallas.push(i);
    }
  } else if (genero === "Unisex") {
    for (let i = 35; i <= 45; i++) {
      tallas.push(i);
    }
  }

  return tallas;
}

let carrito = new Carrito(); // Crear una instancia del carrito

function mostrarDetalles(idProducto) {
  const producto = listadoProductos.find((p) => p.id === idProducto);

  if (producto) {
    // Actualizar los detalles en el modal
    document.getElementById("modal-name").textContent = producto.nombre;
    document.getElementById(
      "modal-price"
    ).textContent = `Precio: $${producto.precio}`;
    document.getElementById("modal-img").src = producto.imagen;

    // Generar las tallas basadas en el género del producto
    const tallas = generarTallas(producto.genero);
    const sizeSelect = document.getElementById("size");
    sizeSelect.innerHTML = ""; // Limpiar las opciones anteriores

    tallas.forEach((talla) => {
      const option = document.createElement("option");
      option.value = talla;
      option.textContent = talla;
      sizeSelect.appendChild(option);
    });

    // Actualizar el botón de añadir al carrito para este producto
    document.getElementById("add-to-cart").onclick = function () {
      const tallaSeleccionada = document.getElementById("size").value;
      const cantidadSeleccionada = parseInt(
        document.getElementById("cantidad").value
      );
      carrito.agregarProducto(
        producto,
        tallaSeleccionada,
        cantidadSeleccionada
      );
      alert(
        `${producto.nombre} añadido al carrito. Talla: ${tallaSeleccionada}, Cantidad: ${cantidadSeleccionada}`
      );
    };
  }
}
        // Simulación del proceso de pago
        function procesarPago() {
          const metodoPago = document.getElementById("payment-method").value;

          alert(`Procesando el pago con tarjeta de ${metodoPago}...`);

          // Simular un retraso de 5 segundos para el pago
          setTimeout(() => {
            var successModal = new bootstrap.Modal(document.getElementById('successModal'));
            successModal.show();
            carrito.vaciarCarrito(); // Vaciar el carrito después del pago
          }, 5000);
        }


    </script>
</body>

</html>